# Promtail version and download URL
promtail_version: "2.9.2"
promtail_download_url: "https://github.com/grafana/loki/releases/download/v{{ promtail_version }}/promtail-linux-amd64.zip"

# User and group settings
promtail_user: "promtail"
promtail_group: "promtail"

# Installation directories
promtail_install_dir: "/usr/local/bin"
promtail_config_dir: "/etc/promtail"
promtail_positions_dir: "/var/lib/promtail"

# Service configuration
promtail_service_enabled: true
promtail_state: "started"

# Default port
promtail_server_port: 9080

# Loki configuration
promtail_loki_url: "http://10.0.5.110:3100/loki/api/v1/push"

# Log configuration
promtail_log_level: "info"

# Scrape configurations
promtail_scrape_configs:
  ########### Employee ##################
  - job_name: systemd-journal1
    journal:
      max_age: 12h
      labels:
        job: employee-api
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        regex: 'employee-api\.service'
        action: keep

  - job_name: employee-api-file-logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: employee-api
          __path__: /var/log/employee-api.log

  ########### Salary ##################
  - job_name: systemd-journal2
    journal:
      max_age: 12h
      labels:
        job: salary-api
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        regex: 'salary-api\.service'
        action: keep

  - job_name: salary-api-file-logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: salary-api
          __path__: /var/log/salary-api.log

  ########### Attendance ##################
  - job_name: systemd-journal3
    journal:
      max_age: 12h
      labels:
        job: attendance-api
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        regex: 'attendance-api\.service'
        action: keep

  - job_name: attendance-api-file-logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: attendance-api
          __path__: /var/log/attendance-api.log

  ########### Scylla ##################
  
  - job_name: scylla-file-logs
  static_configs:
    - targets: [localhost]
      labels:
        job: scylla
        __path__: /var/log/scylla/scylla.log  
  pipeline_stages:
    - match:
        selector: '{job="scylla"}'
        stages:
        - drop:
            expression: "^$"

  ########### Redis ##################
  - job_name: redis-logs
    static_configs:
      - targets: [localhost]
        labels:
          job: redis-logs
          __path__: /var/log/redis/redis-server.log

  ########### Postgres ##################
  - job_name: postgres-logs
    static_configs:
      - targets: [localhost]
        labels:
          job: postgres-logs
          __path__: /var/log/postgresql/postgresql-16-main.log

  ########### Frontend ##################
  - job_name: systemd-journal7
    journal:
      max_age: 12h
      labels:
        job: frontend
    relabel_configs:
      - source_labels: ['__journal__systemd_unit']
        regex: 'frontend\.service'
        action: keep

  - job_name: frontend-file-logs
    static_configs:
      - targets:
          - localhost
        labels:
          job: frontend
          __path__: /var/log/frontend.log

# Additional configuration options
promtail_extra_args: []
